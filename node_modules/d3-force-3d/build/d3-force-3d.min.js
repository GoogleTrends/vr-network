// https://github.com/vasturiano/d3-force-3d Version 1.0.7. Copyright 2017 Vasco Asturiano.
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-binarytree"),require("d3-quadtree"),require("d3-octree"),require("d3-collection"),require("d3-dispatch"),require("d3-timer")):"function"==typeof define&&define.amd?define(["exports","d3-binarytree","d3-quadtree","d3-octree","d3-collection","d3-dispatch","d3-timer"],t):t(n.d3=n.d3||{},n.d3,n.d3,n.d3,n.d3,n.d3,n.d3)}(this,function(n,t,e,r,i,u,o){"use strict";function f(n){return n.x+n.vx}function a(n){return n.y+n.vy}function c(n){return n.z+n.vz}function l(n){return n.index}function h(n,t){var e=n.get(t);if(!e)throw new Error("missing: "+t);return e}function v(n){return n.x}function y(n){return n.y}function d(n){return n.z}var s=function(n,t,e){function r(){var r,u,o=i.length,f=0,a=0,c=0;for(r=0;r<o;++r)u=i[r],f+=u.x||0,a+=u.y||0,c+=u.z||0;for(f=f/o-n,a=a/o-t,c=c/o-e,r=0;r<o;++r)u=i[r],f&&(u.x-=f),a&&(u.y-=a),c&&(u.z-=c)}var i;return null==n&&(n=0),null==t&&(t=0),null==e&&(e=0),r.initialize=function(n){i=n},r.x=function(t){return arguments.length?(n=+t,r):n},r.y=function(n){return arguments.length?(t=+n,r):t},r.z=function(n){return arguments.length?(e=+n,r):e},r},g=function(n){return function(){return n}},x=function(){return 1e-6*(Math.random()-.5)},z=function(n){function i(){function n(n,t,e,r,i,u,o){var f=[t,e,r,i,u,o],a=f[0],c=f[1],l=f[2],v=f[h],d=f[h+1],m=f[h+2],w=n.data,N=n.r,A=M+N;if(!w)return a>g+A||v<g-A||h>1&&(c>z+A||d<z-A)||h>2&&(l>p+A||m<p-A);if(w.index>s.index){var b=g-w.x-w.vx,k=h>1?z-w.y-w.vy:0,j=h>2?p-w.z-w.vz:0,D=b*b+k*k+j*j;D<A*A&&(0===b&&(b=x(),D+=b*b),h>1&&0===k&&(k=x(),D+=k*k),h>2&&0===j&&(j=x(),D+=j*j),D=(A-(D=Math.sqrt(D)))/D*y,s.vx+=(b*=D)*(A=(N*=N)/(q+N)),h>1&&(s.vy+=(k*=D)*A),h>2&&(s.vz+=(j*=D)*A),w.vx-=b*(A=1-A),h>1&&(w.vy-=k*A),h>2&&(w.vz-=j*A))}}for(var i,o,s,g,z,p,M,q,m=l.length,w=0;w<d;++w)for(o=(1===h?t.binarytree(l,f):2===h?e.quadtree(l,f,a):3===h?r.octree(l,f,a,c):null).visitAfter(u),i=0;i<m;++i)s=l[i],M=v[s.index],q=M*M,g=s.x+s.vx,h>1&&(z=s.y+s.vy),h>2&&(p=s.z+s.vz),o.visit(n)}function u(n){if(n.data)return n.r=v[n.data.index];for(var t=n.r=0;t<Math.pow(2,h);++t)n[t]&&n[t].r>n.r&&(n.r=n[t].r)}function o(){if(l){var t,e,r=l.length;for(v=new Array(r),t=0;t<r;++t)e=l[t],v[e.index]=+n(e,t,l)}}var l,h,v,y=1,d=1;return"function"!=typeof n&&(n=g(null==n?1:+n)),i.initialize=function(n,t){l=n,h=t,o()},i.iterations=function(n){return arguments.length?(d=+n,i):d},i.strength=function(n){return arguments.length?(y=+n,i):y},i.radius=function(t){return arguments.length?(n="function"==typeof t?t:g(+t),o(),i):n},i},p=function(n){function t(n){return 1/Math.min(y[n.source.index],y[n.target.index])}function e(t){for(var e=0,r=n.length;e<M;++e)for(var i,u,o,c,l,h=0,y=0,s=0,g=0;h<r;++h)i=n[h],u=i.source,o=i.target,y=o.x+o.vx-u.x-u.vx||x(),v>1&&(s=o.y+o.vy-u.y-u.vy||x()),v>2&&(g=o.z+o.vz-u.z-u.vz||x()),c=Math.sqrt(y*y+s*s+g*g),c=(c-a[h])/c*t*f[h],y*=c,s*=c,g*=c,o.vx-=y*(l=d[h]),v>1&&(o.vy-=s*l),v>2&&(o.vz-=g*l),u.vx+=y*(l=1-l),v>1&&(u.vy+=s*l),v>2&&(u.vz+=g*l)}function r(){if(c){var t,e,r=c.length,l=n.length,v=i.map(c,s);for(t=0,y=new Array(r);t<l;++t)e=n[t],e.index=t,"object"!=typeof e.source&&(e.source=h(v,e.source)),"object"!=typeof e.target&&(e.target=h(v,e.target)),y[e.source.index]=(y[e.source.index]||0)+1,y[e.target.index]=(y[e.target.index]||0)+1;for(t=0,d=new Array(l);t<l;++t)e=n[t],d[t]=y[e.source.index]/(y[e.source.index]+y[e.target.index]);f=new Array(l),u(),a=new Array(l),o()}}function u(){if(c)for(var t=0,e=n.length;t<e;++t)f[t]=+z(n[t],t,n)}function o(){if(c)for(var t=0,e=n.length;t<e;++t)a[t]=+p(n[t],t,n)}var f,a,c,v,y,d,s=l,z=t,p=g(30),M=1;return null==n&&(n=[]),e.initialize=function(n,t){c=n,v=t,r()},e.links=function(t){return arguments.length?(n=t,r(),e):n},e.id=function(n){return arguments.length?(s=n,e):s},e.iterations=function(n){return arguments.length?(M=+n,e):M},e.strength=function(n){return arguments.length?(z="function"==typeof n?n:g(+n),u(),e):z},e.distance=function(n){return arguments.length?(p="function"==typeof n?n:g(+n),o(),e):p},e},M=10,q=Math.PI*(3-Math.sqrt(5)),m=Math.PI/24,w=function(n,t){function e(){r(),z.call("tick",c),h<v&&(x.stop(),z.call("end",c))}function r(){var t,e,r=n.length;for(h+=(d-h)*y,g.each(function(n){n(h)}),t=0;t<r;++t)e=n[t],null==e.fx?e.x+=e.vx*=s:(e.x=e.fx,e.vx=0),l>1&&(null==e.fy?e.y+=e.vy*=s:(e.y=e.fy,e.vy=0)),l>2&&(null==e.fz?e.z+=e.vz*=s:(e.z=e.fz,e.vz=0))}function f(){for(var t,e=0,r=n.length;e<r;++e){if(t=n[e],t.index=e,isNaN(t.x)||l>1&&isNaN(t.y)||l>2&&isNaN(t.z)){var i=M*(l>2?Math.cbrt(e):l>1?Math.sqrt(e):e),u=e*q,o=e*m;t.x=i*(l>1?Math.cos(u):1),l>1&&(t.y=i*Math.sin(u)),l>2&&(t.z=i*Math.sin(o))}(isNaN(t.vx)||l>1&&isNaN(t.vy)||l>2&&isNaN(t.vz))&&(t.vx=0,l>1&&(t.vy=0),l>2&&(t.vz=0))}}function a(t){return t.initialize&&t.initialize(n,l),t}t=t||2;var c,l=Math.min(3,Math.max(1,Math.round(t))),h=1,v=.001,y=1-Math.pow(v,1/300),d=0,s=.6,g=i.map(),x=o.timer(e),z=u.dispatch("tick","end");return null==n&&(n=[]),f(),c={tick:r,restart:function(){return x.restart(e),c},stop:function(){return x.stop(),c},numDimensions:function(n){return arguments.length?(l=Math.min(3,Math.max(1,Math.round(n))),g.each(a),c):l},nodes:function(t){return arguments.length?(n=t,f(),g.each(a),c):n},alpha:function(n){return arguments.length?(h=+n,c):h},alphaMin:function(n){return arguments.length?(v=+n,c):v},alphaDecay:function(n){return arguments.length?(y=+n,c):+y},alphaTarget:function(n){return arguments.length?(d=+n,c):d},velocityDecay:function(n){return arguments.length?(s=1-n,c):1-s},force:function(n,t){return arguments.length>1?(null==t?g.remove(n):g.set(n,a(t)),c):g.get(n)},find:function(){var t,e,r,i,u,o,f=Array.prototype.slice.call(arguments),a=f.shift()||0,c=(l>1?f.shift():null)||0,h=(l>2?f.shift():null)||0,v=f.shift()||1/0,y=0,d=n.length;for(v*=v,y=0;y<d;++y)u=n[y],t=a-u.x,e=c-(u.y||0),r=h-(u.z||0),(i=t*t+e*e+r*r)<v&&(o=u,v=i);return o},on:function(n,t){return arguments.length>1?(z.on(n,t),c):z.on(n)}}},N=function(){function n(n){var i,h=f.length,s=(1===a?t.binarytree(f,v):2===a?e.quadtree(f,v,y):3===a?r.octree(f,v,y,d):null).visitAfter(u);for(l=n,i=0;i<h;++i)c=f[i],s.visit(o)}function i(){if(f){var n,t,e=f.length;for(h=new Array(e),n=0;n<e;++n)t=f[n],h[t.index]=+s(t,n,f)}}function u(n){var t,e,r,i,u,o,f=0;if(n.length){for(r=i=u=o=0;o<4;++o)(t=n[o])&&(e=t.value)&&(f+=e,r+=e*(t.x||0),i+=e*(t.y||0),u+=e*(t.z||0));n.x=r/f,a>1&&(n.y=i/f),a>2&&(n.z=u/f)}else{t=n,t.x=t.data.x,a>1&&(t.y=t.data.y),a>2&&(t.z=t.data.z);do{f+=h[t.data.index]}while(t=t.next)}n.value=f}function o(n,t,e,r,i){if(!n.value)return!0;var u=[e,r,i][a-1],o=n.x-c.x,f=a>1?n.y-c.y:0,v=a>2?n.z-c.z:0,y=u-t,d=o*o+f*f+v*v;if(y*y/M<d)return d<p&&(0===o&&(o=x(),d+=o*o),a>1&&0===f&&(f=x(),d+=f*f),a>2&&0===v&&(v=x(),d+=v*v),d<z&&(d=Math.sqrt(z*d)),c.vx+=o*n.value*l/d,a>1&&(c.vy+=f*n.value*l/d),a>2&&(c.vz+=v*n.value*l/d)),!0;if(!(n.length||d>=p)){(n.data!==c||n.next)&&(0===o&&(o=x(),d+=o*o),a>1&&0===f&&(f=x(),d+=f*f),a>2&&0===v&&(v=x(),d+=v*v),d<z&&(d=Math.sqrt(z*d)));do{n.data!==c&&(y=h[n.data.index]*l/d,c.vx+=o*y,a>1&&(c.vy+=f*y),a>2&&(c.vz+=v*y))}while(n=n.next)}}var f,a,c,l,h,s=g(-30),z=1,p=1/0,M=.81;return n.initialize=function(n,t){f=n,a=t,i()},n.strength=function(t){return arguments.length?(s="function"==typeof t?t:g(+t),i(),n):s},n.distanceMin=function(t){return arguments.length?(z=t*t,n):Math.sqrt(z)},n.distanceMax=function(t){return arguments.length?(p=t*t,n):Math.sqrt(p)},n.theta=function(t){return arguments.length?(M=t*t,n):Math.sqrt(M)},n},A=function(n){function t(n){for(var t,e=0,o=r.length;e<o;++e)t=r[e],t.vx+=(u[e]-t.x)*i[e]*n}function e(){if(r){var t,e=r.length;for(i=new Array(e),u=new Array(e),t=0;t<e;++t)i[t]=isNaN(u[t]=+n(r[t],t,r))?0:+o(r[t],t,r)}}var r,i,u,o=g(.1);return"function"!=typeof n&&(n=g(null==n?0:+n)),t.initialize=function(n){r=n,e()},t.strength=function(n){return arguments.length?(o="function"==typeof n?n:g(+n),e(),t):o},t.x=function(r){return arguments.length?(n="function"==typeof r?r:g(+r),e(),t):n},t},b=function(n){function t(n){for(var t,e=0,o=r.length;e<o;++e)t=r[e],t.vy+=(u[e]-t.y)*i[e]*n}function e(){if(r){var t,e=r.length;for(i=new Array(e),u=new Array(e),t=0;t<e;++t)i[t]=isNaN(u[t]=+n(r[t],t,r))?0:+o(r[t],t,r)}}var r,i,u,o=g(.1);return"function"!=typeof n&&(n=g(null==n?0:+n)),t.initialize=function(n){r=n,e()},t.strength=function(n){return arguments.length?(o="function"==typeof n?n:g(+n),e(),t):o},t.y=function(r){return arguments.length?(n="function"==typeof r?r:g(+r),e(),t):n},t},k=function(n){function t(n){for(var t,e=0,o=r.length;e<o;++e)t=r[e],t.vz+=(u[e]-t.z)*i[e]*n}function e(){if(r){var t,e=r.length;for(i=new Array(e),u=new Array(e),t=0;t<e;++t)i[t]=isNaN(u[t]=+n(r[t],t,r))?0:+o(r[t],t,r)}}var r,i,u,o=g(.1);return"function"!=typeof n&&(n=g(null==n?0:+n)),t.initialize=function(n){r=n,e()},t.strength=function(n){return arguments.length?(o="function"==typeof n?n:g(+n),e(),t):o},t.z=function(r){return arguments.length?(n="function"==typeof r?r:g(+r),e(),t):n},t};n.forceCenter=s,n.forceCollide=z,n.forceLink=p,n.forceManyBody=N,n.forceSimulation=w,n.forceX=A,n.forceY=b,n.forceZ=k,Object.defineProperty(n,"__esModule",{value:!0})});